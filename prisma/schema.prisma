generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id         String      @id @default(uuid()) @db.Uuid
  email      String      @unique @db.VarChar(255)
  name       String?     @db.VarChar(255)
  avatar     String?     @db.VarChar(100)
  createdAt  DateTime    @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt  DateTime    @updatedAt @map("updated_at") @db.Timestamp(6)
  
  dashboards Dashboard[]
  sessions   Session[]

  @@index([email])
  @@map("users")
}

model Dashboard {
  id        String   @id @default(uuid()) @db.Uuid
  userId    String   @map("user_id") @db.Uuid
  name      String   @default("My Dashboard") @db.VarChar(255)
  isDefault Boolean  @default(false) @map("is_default")
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamp(6)
  
  user    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  widgets Widget[]

  @@index([userId])
  @@index([userId, isDefault])
  @@map("dashboards")
}

model Widget {
  id          String     @id @default(uuid()) @db.Uuid
  dashboardId String     @map("dashboard_id") @db.Uuid
  type        WidgetType @map("widget_type")
  title       String?    @db.VarChar(255)
  config      Json       @default("{}") @db.JsonB
  order       Int        @db.Integer
  createdAt   DateTime   @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt   DateTime   @updatedAt @map("updated_at") @db.Timestamp(6)
  
  dashboard Dashboard @relation(fields: [dashboardId], references: [id], onDelete: Cascade)

  @@unique([dashboardId, order])
  @@index([dashboardId])
  @@index([dashboardId, order])
  @@map("widgets")
}

model Session {
  id        String   @id @default(uuid()) @db.Uuid
  userId    String   @map("user_id") @db.Uuid
  token     String   @unique @db.Text
  expiresAt DateTime @map("expires_at") @db.Timestamp(6)
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([token])
  @@index([expiresAt])
  @@map("sessions")
}

enum WidgetType {
  weather
  clock
  date
  quote
  notes
  color_generator

  @@map("widget_type")
}